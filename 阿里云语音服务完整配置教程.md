# 阿里云语音服务完整配置教程

## 🎯 统一使用阿里云语音服务

阿里云智能语音交互同时提供：
- **语音识别**（ASR）：语音转文字
- **语音合成**（TTS）：文字转语音

## 📋 配置步骤

### 1. 注册阿里云账号

1. 访问：https://www.aliyun.com/
2. 点击"免费注册"
3. 完成账号注册和实名认证（必须）

### 2. 开通智能语音交互服务

1. **搜索服务**：
   - 登录阿里云控制台
   - 搜索"智能语音交互"
   - 点击进入产品页面

2. **开通服务**：
   - 点击"立即开通"
   - 选择"按量付费"（有免费额度）
   - 确认开通

### 3. 创建项目和获取AppKey

1. **进入控制台**：https://nls-portal.console.aliyun.com/
2. **创建项目**：
   - 点击"创建项目"
   - 项目名称：`AI角色扮演语音服务`
   - 项目描述：`用于AI角色扮演系统的语音识别和合成`
   - 点击"确定"
3. **获取AppKey**：
   - 项目创建成功后，会显示AppKey
   - 复制并保存AppKey（类似：`nls-service-xxxxxxxxx`）

### 4. 获取AccessKey

1. **进入AccessKey管理**：
   - 点击右上角头像 → AccessKey管理
   - 或直接访问：https://usercenter.console.aliyun.com/
2. **创建AccessKey**：
   - 点击"创建AccessKey"
   - 系统会生成AccessKey ID和AccessKey Secret
   - ⚠️ **重要**：AccessKey Secret只显示一次，请立即复制保存

### 5. 配置到项目中

```yaml
ai:
  speech:
    provider: aliyun  # 统一使用阿里云
    aliyun:
      access-key-id: LTAI4G6FMA7xxxxxxxxx      # 你的AccessKey ID
      access-key-secret: abc123def456ghi789jkl  # 你的AccessKey Secret
      app-key: nls-service-xxxxxxxxx            # 你的AppKey
```

### 6. 免费额度说明

**语音识别（ASR）**：
- 免费额度：每月2小时
- 超出后：0.0008元/秒

**语音合成（TTS）**：
- 免费额度：每月500万字符
- 超出后：0.0008元/百字符

**对于开发测试完全够用！**

---

## 🔧 修改SpeechService实现

让我修改SpeechService，统一使用阿里云：

```java
@Slf4j
@Service
public class SpeechService {
    
    @Value("${ai.speech.aliyun.access-key-id}")
    private String accessKeyId;
    
    @Value("${ai.speech.aliyun.access-key-secret}")
    private String accessKeySecret;
    
    @Value("${ai.speech.aliyun.app-key}")
    private String appKey;
    
    /**
     * 阿里云语音识别
     */
    public String speechToText(byte[] audioData) {
        try {
            // 使用阿里云语音识别API
            // 实际实现需要集成阿里云SDK
            log.info("使用阿里云进行语音识别，音频大小: {} bytes", audioData.length);
            
            // TODO: 集成阿里云ASR SDK
            return "这是语音识别的结果"; // 占位返回
        } catch (Exception e) {
            log.error("阿里云语音识别异常", e);
            return null;
        }
    }
    
    /**
     * 阿里云语音合成
     */
    public byte[] textToSpeech(String text, String voice) {
        try {
            // 使用阿里云语音合成API
            log.info("使用阿里云进行语音合成，文本: {}, 音色: {}", text, voice);
            
            // TODO: 集成阿里云TTS SDK
            return new byte[0]; // 占位返回
        } catch (Exception e) {
            log.error("阿里云语音合成异常", e);
            return null;
        }
    }
}
```

---

## 📦 添加阿里云SDK依赖

在pom.xml中添加阿里云语音SDK：

```xml
<!-- 阿里云语音服务SDK -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>aliyun-java-sdk-core</artifactId>
    <version>4.6.3</version>
</dependency>
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>aliyun-java-sdk-nls-cloud-meta</artifactId>
    <version>1.0.0</version>
</dependency>
```

---

## 🚀 快速测试配置

### 1. 更新application.yml

```yaml
ai:
  speech:
    aliyun:
      access-key-id: 你的AccessKey_ID
      access-key-secret: 你的AccessKey_Secret  
      app-key: 你的AppKey
```

### 2. 删除百度相关配置

```yaml
ai:
  speech:
    # 删除百度配置
    # baidu:
    #   app-id: your-baidu-app-id
    #   api-key: your-baidu-api-key
    #   secret-key: your-baidu-secret-key
    
    aliyun:
      access-key-id: 你的配置
      access-key-secret: 你的配置
      app-key: 你的配置
```

### 3. 测试语音接口

```bash
# 测试语音合成
curl -X POST "http://localhost:8080/api/speech/synthesis" \
  -H "Content-Type: application/json" \
  -d '{"text": "你好，我是AI助手", "voice": "xiaoyun"}'

# 测试支持的语音列表
curl -X GET "http://localhost:8080/api/speech/voices"
```

---

## 🔒 安全配置建议

### 使用环境变量（推荐）

```yaml
ai:
  speech:
    aliyun:
      access-key-id: ${ALIYUN_ACCESS_KEY_ID:your-default-access-key-id}
      access-key-secret: ${ALIYUN_ACCESS_KEY_SECRET:your-default-access-key-secret}
      app-key: ${ALIYUN_APP_KEY:your-default-app-key}
```

### 设置环境变量

**Windows:**
```cmd
set ALIYUN_ACCESS_KEY_ID=你的实际AccessKey_ID
set ALIYUN_ACCESS_KEY_SECRET=你的实际AccessKey_Secret
set ALIYUN_APP_KEY=你的实际AppKey
```

---

## 📊 阿里云语音服务优势

1. **服务稳定**：阿里云基础设施可靠
2. **中文优化**：对中文语音处理效果好
3. **免费额度大**：TTS每月500万字符免费
4. **一站式服务**：ASR + TTS 统一管理
5. **文档完善**：中文文档，技术支持好

---

## ❓ 常见问题

### Q: AccessKey在哪里找？
**A**: 阿里云控制台 → 右上角头像 → AccessKey管理

### Q: AppKey在哪里找？
**A**: 智能语音交互控制台 → 项目管理 → 查看项目详情

### Q: 免费额度够用吗？
**A**: 开发测试完全够用，TTS每月500万字符很充足

### Q: 如何监控使用量？
**A**: 智能语音交互控制台可以查看调用量和费用

---

## 🎯 下一步行动

1. **注册阿里云账号**（如果还没有）
2. **开通智能语音交互服务**
3. **创建项目获取AppKey**
4. **获取AccessKey**
5. **配置到application.yml**
6. **重启应用测试**

需要我帮你配置哪一步？或者有其他问题吗？